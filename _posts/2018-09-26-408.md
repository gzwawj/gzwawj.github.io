---
layout: post
title:  ffmpeg+nginx+rtmp直播系统搭建
date:   2018/09/26 18:06
categories:   应用工具
tags: linux命令 ffmpeg 
excerpt: 实现目标：  安装最新的NGINXweb服务器 官网下载  下载完之后解压目录、进入目录 cd nginx-1.14.0/   ./configure --prefix=/usr/local/nginx    在执行编译安装的时候需要安装编译器 在安装过程中可能出现依赖问题： openssl依赖： sudo apt-get install openssl libssl-dev    pcre依赖：
comment: true
---
* content
{:top}

实现目标：

安装最新的NGINXweb服务器
<a href="http://nginx.org/en/download.html">官网下载</a>

下载完之后解压目录、进入目录
<pre><code class="language-shell ">cd nginx-1.14.0/  
./configure --prefix=/usr/local/nginx  
</code></pre>
在执行编译安装的时候需要安装编译器
在安装过程中可能出现依赖问题：
<h5>openssl依赖：</h5>
<pre><code class="language-shell ">sudo apt-get install openssl libssl-dev  
</code></pre>
<h5>pcre依赖：</h5>
<pre><code class="language-shell ">sudo apt-get install libpcre3 libpcre3-dev  
</code></pre>
<h5>zlib依赖：</h5>
<pre><code class="language-shell ">sudo apt-get install zlib1g-dev  
</code></pre>
下载<a href="https://github.com/arut/nginx-rtmp-module">nginx-rtmp-module</a>模块 <code>git clone https://github.com/arut/nginx-rtmp-module.git</code>
<h5>添加模块</h5>
<pre><code class="language-shell ">./configure --prefix=/usr/local/nginx --add-module=~/nginx-rtmp-module --with-http_ssl_module  
</code></pre>
<h5>进行编译和安装</h5>
<pre><code class="language-shell ">make #编译  
sudo make install #安装  
</code></pre>
安装完成后查看信息
<pre><code class="language-shell ">nginx -v #查看版本  
nginx -V #查看详细信息及模块  
</code></pre>
修改nginx.conf配置文件
<pre><code class="">#下拉至文档末尾，添加RTMP服务  
rtmp {

server {

listen 2018; #服务端口，避开重要端口即可

application live {  
live on;  
}  
application hls_alic{  
live on;  
hls on;  
hls_path /tmp/hls;  
}  
}  
#不要关闭文档，回到http服务配置处，按以下样式对其修改,最后保存并退出  
http {  
include mime.types;

default_type application/octet-stream;

sendfile on;

keepalive_timeout 65;

server {

listen 80;

server_name localhost;  
location /stat {  
rtmp_stat all;  
rtmp_stat_stylesheet stat.xsl;  
}

location /stat.xsl {  
root /usr/local/nginx/nginx-rtmp-module/;  
}

location / {  
root html;  
index index.html index.htm;  
}

error_page 404 /404.html  
location = /50x.html {  
root html;  
}  
}  
}

</code></pre>
<h4>配置ffmpeg</h4>
<h5>安装ffmpeg</h5>
<pre><code class="language-shell ">sudo add-apt-repository ppa:kirillshkrogalev/ffmpeg-next  
sudoapt-get update  
sudo apt-get install ffmpeg

</code></pre>
<h5>启用ffmpeg进行推流</h5>
<pre><code class="language-shell ">ffmpeg -f video4linux2-framerate 25 -video_size 640*480 -i /dev/video0 -f flv rtmp://192.168.1.107:2018/live  
</code></pre>
rtmp://192.168.1.107:2018/live是直播地址
    